<div class="references-step" [formGroup]="referencesForm">

  <header class="references-step__header">
    <h2 class="references-step__title">Referencias Visuales</h2>
    <p class="references-step__subtitle">
      Mu√©stranos qu√© te inspira. Sube al menos 2 im√°genes de marcas, dise√±os o estilos que te gusten.
    </p>
  </header>

  <div class="references-step__grid" formArrayName="files">
    @for (group of filesArray.controls; track $index) {
    <div class="references-step__card" [formGroupName]="$index">

      <h3 class="references-step__card-title">Referente #{{ $index + 1 }}</h3>

      <div class="references-step__dropzone" [class.references-step__dropzone--active]="isDraggingOver[$index]"
        [class.references-step__dropzone--filled]="getReferenceGroup($index).get('fileUrl')?.value"
        (dragover)="onDragOver($event, $index)" (dragleave)="onDragLeave($event, $index)"
        (drop)="onDrop($event, $index)" (click)="fileInput.click()"> @if
        (getReferenceGroup($index).get('fileUrl')?.value; as imageUrl) {
        <img [src]="imageUrl" alt="Vista previa de Referente {{ $index + 1 }}" class="references-step__preview-img">
        <button type="button" (click)="$event.stopPropagation(); removeFile($index)" class="references-step__remove-btn"
          aria-label="Eliminar imagen">
          ‚úï
        </button>
        } @else {
        <div class="references-step__dropzone-prompt">
          <span class="references-step__dropzone-icon">üì§</span>
          <span>
            <strong>Arrastra tu imagen aqu√≠</strong>
            <br> o haz clic para seleccionar
          </span>
        </div>
        }

        <input type="file" class="references-step__file-input" (change)="onFileSelected($event, $index)"
          accept="image/png, image/jpeg, image/gif, image/webp" #fileInput>
      </div>

      <div class="references-step__form-group">
        <label [for]="'desc-' + $index" class="references-step__label">
          Descripci√≥n (no m√°s de 2 oraciones)
        </label>
        <textarea [id]="'desc-' + $index" formControlName="description" class="references-step__textarea"
          placeholder="¬øQu√© te gusta de esta referencia? (colores, tipograf√≠a, estructura...)" rows="3">
          </textarea>
      </div>

    </div>
    }
  </div>

</div>